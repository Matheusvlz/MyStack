using MySql.Data.MySqlClient;
using MySqlX.XDevAPI.Common;
using MyStack.Pacotes.Entidades;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Text;
using System.Threading.Tasks;
using System.Windows;

namespace MyStackV_.Pacotes.BancodeDados
{
    internal class EmpresaBD
    {
        ConexãoBD conex;
        Empresa empresa;
        Usuario usuario;
        public EmpresaBD() 
        {
            usuario = new Usuario();
            conex = new ConexãoBD();
            empresa = new Empresa();
        }
        public bool IncluirEmpresa()
        {
            bool status = true;
            try
            {
                using (MySqlConnection conectar = conex.ObterConexao())
                {
                   
                 
                    string query = "INSERT INTO empresa (NomeEmpresa, Email, Senha) VALUES (@NomeEmpresa, @Email, @Senha)";
                    MySqlCommand command = new MySqlCommand(query, conectar);
                    command.Parameters.AddWithValue("@NomeEmpresa", empresa.getNomeEmpresa());
                    command.Parameters.AddWithValue("@Email", empresa.getEmail());
                    command.Parameters.AddWithValue("@Senha", empresa.getSenhaempresa());

                    conectar.Open();
                    command.ExecuteNonQuery();
                    return status;
                }
            }
            catch (Exception e)
            {
                MessageBox.Show("Erro: " + e.Message);
                return false;
            }

        }
        public int ColocarIdEmpresa(string email)
        {
            try
            {
                using (MySqlConnection conectar = conex.ObterConexao())
                {
                    string query = "SELECT IdEmpresa FROM empresa WHERE Email = @Email";
                    MySqlCommand command = new MySqlCommand(query, conectar);
                    command.Parameters.AddWithValue("@Email", email);

                    conectar.Open();
                    object result = command.ExecuteScalar();
                    if (result != null)
                    {
                        int idempresa = Convert.ToInt32(result);
                        return idempresa;
                    }
                    else
                    {
                        MessageBox.Show("Não foi possível encontrar uma empresa com o email fornecido.");
                        return 0;
                    }
                }
            }
            catch (Exception e)
            {
                MessageBox.Show("Erro: " + e.Message);
                return 0;
            }
        }
     
        public bool ValidarAcessoempresa(string login, string senha)
        {
            bool status = true;
            return status;

            try
            {
                using (MySqlConnection conectar = conex.ObterConexao())
                {
                    conectar.Open();
                    string query = "SELECT COUNT(*) FROM empresa WHERE Email = @Email AND Senha = @Senha";
                    MySqlCommand command = new MySqlCommand(query, conectar);
                    command.Parameters.AddWithValue("@Email", login);
                    command.Parameters.AddWithValue("@Senha", senha);


                    int resultado = Convert.ToInt32(command.ExecuteScalar());
                    if (resultado > 0)
                    {
                        return status;
                    }
                    else
                    {
                        MessageBox.Show("Dados Nao Coinsidem.");
                        return status = false;
                    }
                }
            }
            catch (Exception e)
            {
                MessageBox.Show("Erro: " + e.Message);
                return status = false;
            }
        }
        public void ExcluirEmpresa()
        {

        }
        public void EditarEmpresa()
        {

        }
    }
}
